<% title "Media Requests" %>
<div id="content">
  <div class="inner_content">
	<h3><%= @media_requests_by_type.size %> Media Requests</h3>

	<% @media_requests_by_type.each do |media_request| %>
		<% div_for media_request, :class => 'clearfix summary' do %>
			<p>
				From: <%= media_request.sender.name %>
				(<%= media_request.publication || media_request.sender.publication %>)
			</p>
			<% if media_request.employment_search.present? %>
			<p>To: <%= media_request.employment_search.try(:employments).map(&:employee_name).uniq.try(:to_sentence) %></p>
			<% end %>
			<p>Due by <%= media_request.due_date.try(:to_s, :long_ordinal) %></p>
			<p>Sent: <%= media_request.created_at.to_s(:sentence) %></p>

			<p class="message"><%= truncate(media_request.message, :length => 100) %></p>

			<ul class="responses">
			<% if media_request.reply_count > 0 %>
				<% for discussion in media_request.discussions_with_comments %>
					<% if comment = discussion.comments.not_user(current_user).last %>
					<li class="response">
						<%= last_comment_and_date_span(comment) %>
					</li>
					<% end -%>
				<% end %>
			<% else %>
				<li class="noone">No one has responded yet</li>
			<% end %>
			</ul>
		<% end # div -%>
	<% end %>
  </div><!-- /inner_content -->
</div><!-- /content -->

<%= render 'mediafeed/shared/mediafeed_sidebar' %>
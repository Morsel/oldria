<% title "Edit Your Account" %>

<div class="fieldset_box" id="plans">
  <h3>Account Status</h3>
  <div class="current">
    Your current account status is <%= @user.account_type %>.
    <% if @user.premium_account? %> 
      <span id="start_date">
        You have been a premium member 
        since <%= @user.subscription.start_date.to_s(:long) %>
      </span>
      <% if @user.subscription && @user.subscription.in_overtime? %>
        <span id="end_date">
          This account has been canceled and will end 
          <%= @user.subscription.end_date.to_s(:long)%>
        </span>
      <% end %>
    <% end %>
  </div>
  
  <% if @user.account_in_overtime? %>
    <div id="overtime">
      You can modify your premium account again after the current 
      subscription expires.
    </div>
  <% else %>
    <div id="upgrade_link">
      <% if @user.premium_account? %>
        <%= link_to (image_tag('x.png') + "Downgrade to basic"), 
            subscription_path(@user), :method => :delete,
            :confirm => "Do you really want to cancel your premium subscription?",
            :class => 'button negative' %>
      <% else %>
        <%= link_to (image_tag('tick.png') + "Upgrade to Premium"), 
            new_subscription_path(:id => @user.id),
            :class => 'button positive' %>
      <% end %>
    </div>
  <% end %>
</div>

<br clear="all"/>

<% form_for @user, :html => { :multipart => true } do |f| %>
    <fieldset class="headshot">
        <h3>Headshot</h3>
        <p><%= image_tag @user.avatar.url(:thumb), :class => 'thumbnail' %></p>
        <p><%= f.label :avatar, "Headshot" %> <%= f.file_field :avatar %></p>
        <p>
            <%= button_tag (image_tag('tick.png') + "Upload Headshot"), :class => 'positive' %>
            <span class="button-separator"> or </span> 
            <%= link_to (image_tag('x.png') + "Remove my headshot"), remove_avatar_user_path(@user), :method => :put, :confirm => "Are you sure you want to remove your headshot? You'll have to upload another one later to get it back", :class => 'button negative' %>
        </p>
    </fieldset>
<% end %>

<fieldset id="twitter">
    <h3>Twitter</h3>
    <hr />
    <p><%= link_to "Help?  Read our Twitter 101 introduction in the Marketing Manual.", public_page_path('twitter_101_introduction') %></p>

    <% if @user.twitter_authorized? -%>
    <p>
        You currently have your Twitter account set up as <em><%= @user.twitter_username %></em>. To change which Twitter account you want your SpoonFeed account linked with, you can remove the Twitter credentials below, and then setup Twitter again.<br/>
        <%= link_to (image_tag('x.png') + "Remove Twitter Information"), remove_twitter_user_path(@user), :confirm => "Are you sure you want to unlink your Twitter account? This action cannot be undone.", :method => :put, :class => 'button negative' %>
        <%= link_to 'Read Twitter Timeline', twitter_timelines_path, :class=>'button positive' %>
    </p>
    <% elsif @user.twitter_allowed? -%>
    <%= link_to "Setup Twitter", new_twitter_authorization_url, :class=>'sf-button' %>
    <% end -%>
</fieldset>

<fieldset id="facebook">
    <h3>Facebook</h3>
    <hr/>
    <p><%= link_to "Help?  Read everything you need to know about Facebook in the Marketing Manual.", public_page_path('facebook_101_introduction') %></p>

    <%- if @fb_user -%>
      <p>
          You are currently linked to your Facebook account <em>"<%= @fb_user.name %>"</em>. You can connect to a different Facebook profile by disconnecting below, then setting up Facebook again.<br/>
          <%= fb_logout_link "#{image_tag('x.png')} Disconnect", fb_deauth_user_path(@user), :class => 'button negative' %>
      </p>
      <% unless @fb_user.accounts.blank? %>
        <div class="clear" style="padding-top: 1em;">
            <p>Configure a page to post status updates to:</p>
            <% form_tag fb_page_auth_user_path(@user) do %>
                <%= select_tag "facebook_page", "<option>&nbsp;</option>" + options_from_collection_for_select(@fb_user.accounts, :id, :name, @user.facebook_page_id.to_s) %>
                <%= submit_tag "Save" %>
            <% end %>
        </div>
      <% end %>

    <%- else -%>
      <%= link_to "Setup Facebook", fb_auth_user_path(@user), :class => 'sf-button' %>
    <%- end -%>
</fieldset>

<%= render :partial => 'form' %>

<hr/>

<p><%= link_to "Cancel editing", profile_path(@user.username), :class => 'button' %></p>
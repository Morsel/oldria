<% title "#{@chapter.title} - #{@subject.name} - Behind The Line", false %>

<%= render :partial => 'shared/add_this', :locals => {:responder => responder = @restaurant || @subject} %>

<% javascript_tag do %>
  var addthis_share = {
    url: '<%= url_for_question(responder, @chapter.id, nil, true) %>',
    title: $('title').text().replace('Spoonfeed','Soapbox')
  }
<% end %>
<h1 id="btl-title" class="btl"><%= link_to "<span class=\"btl-art\">Behind the Line:</span> <span class=\"name\">#{btl_title_for(@subject)}</span>", find_btl_url_for(@subject) %></h1>

<h2 id="topic_title">Topic: <%= @chapter.topic.title %></h2>
<%= render :partial => 'restaurant_questions/topic_nav', :locals => { :next_topic => @next_topic, :prev_topic => @previous_topic } %>

<div id="btl_answers" class="btl-my-answers">
  <div id="" class="clear clearfix">
    <h3><%= @chapter.title %></h3>
    <% if @next.present? or @previous.present? -%>
      <nav id="chapter_nav" class="topic-nav clearfix">
        <% if @next.present? -%>
          <%= link_to "Next: #{truncate(@next.title, :length => 20, :omission => '&hellip;')}", link_for_questions(:subject => @subject, :chapter_id => @next), :class => 'next' %>
        <% end -%>
        <% if @previous.present? -%>
          <%= link_to "Prev: #{truncate(@previous.title, :length => 20, :omission => '&hellip;')}", link_for_questions(:subject => @subject, :chapter_id => @previous), :class => 'prev' %>
        <% end -%>
      </nav>
    <% end -%>
  </div>

<% if can_edit_profile_questions(@subject) && !params[:controller].match(/soapbox/) %><%# let's edit these answers %>
  <% form_tag link_for_profile_answers(:subject => @subject) do %>
    <% @questions.each do |question| %>
      <% div_for question do %>
          <h4>Q: <%= question.title %></h4>
          <%= render :partial => "profile_answers/form", :locals => { :answer => find_answer_for(question, @subject) } %>
      <% end %>
    <% end %>
  <% end %><%# end form %>

  <div id="loading-wait" style="display: none">
    <%= image_tag "ajax-loader.gif" %>
    <p>Please wait while we save your responses</p>
  </div>

  <p class="clear">Answers to your questions will be posted on your profile and can be used by Restaurant Intelligence Agency to increase traffic to the site.</p>

<% else -%><%# no editing by other users %>

  <% for question in @questions -%>
    <% div_for question do %>
      <h4><span class="letter-q">Q:</span> <%= link_to question.title, link_for_question(question) %></h4>
      <% if answer = answer_for(@subject, question) %>
        <p><%= answer.answer %></p>
        <span class="timestamp">Last updated: <%= answer.try(:updated_at).try(:strftime, "%b %e %Y") %></span>
      <% else %>
        <p>Not answered yet.</p>
      <% end %>
    <% end -%>
  <% end -%>
<% end -%>
</div>


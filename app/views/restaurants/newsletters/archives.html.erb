<% title "Newsletter Archive :: #{@restaurant.name}", false %>

<div id="restaurant_profile_view" class="edit clear clearfix">
    <%= render 'restaurants/restaurant_editing_header' %>

    <div id="editing_restaurant">
        <div id="restaurant_pages" class="clearfix">

            <%- if @restaurant.premium_account? -%>

              <nav id="restaurant_feature_nav">
                <%= link_to 'Settings', restaurant_newsletters_path(:restaurant_id => @restaurant) %>
                <%= link_to 'Subscribers', newsletter_subscriptions_restaurant_path(@restaurant) if @restaurant.shareable_newsletter_subscribers.present? %>
                <%= active_link_to 'Archives', archives_restaurant_newsletters_path(:restaurant_id => @restaurant) %>
              </nav>

              <div id="restaurant_features_content" style="width:700px;">

                <h1 class="pg_title">Newsletter Archive</h1>

                <!-- <div id="read_messages" style="width:670px;margin:0;"> -->
                  <div class="editing clearfix clear">
                   
                    <% unless @restaurant.restaurant_newsletters.blank? %>
                      <table style="width: 100%" class="archives">
                          <thead>
                              <tr>
                                  <th style="width:10%;">Id</th>
                                  <th style="width:55%;">Introduction</th>
                                  <th style="width:30%;">Sent Date</th>
                                  <th style="width:5%;">Action</th>
                              </tr>
                          </thead>
                          <tbody>
                            <% @restaurant.restaurant_newsletters.find(:all,:order => "created_at desc").each_with_index do |newsletter,i| %>
                              <tr >
                                <td style="width:10%;"><%= i+1 %></td>
                                <td style="width:55%;"><%= truncate(newsletter.introduction,:length=>200) %></td>
                                <td style="width:30%;"><%= newsletter.created_at.to_formatted_s(:long) %></td>                        
                                <td style="width:5%;"><%= link_to "view",restaurant_newsletter_path(@restaurant,newsletter),:target =>"_blank" %></td>
                              </tr>
                            <% end %>
                          </tbody>
                      </table>
                     <% else %>
                        <p> Sorry! No newsletter yet.</p>
                     <% end %> 
                  </div>
                <!-- </div> -->

              </div>

            <%- else -%>
              <p><%= link_to "Upgrade to a premium account", new_subscription_path(@restaurant) %> to access your newsletter!</p>
            <%- end -%>

        </div>
    </div><!-- /editing_restaurant -->
</div><!-- /restaurant_profile_view -->
<% title "Edit Profile" %>

<% content_for :head do -%>
  <%= stylesheet_link_tag 'colorbox' %>
<% end -%>

<section id="profile-tabs">
    <nav id="profile-options">
        <span><a href="#profile-edit-account">Account</a></span>
        <span><a href="#profile-summary">Profile Summary</a></span> 
        <% unless @profile.new_record? %>
        <span><a href="#profile-extended">Extended Profile</a></span>
        <% end %>
        <span><a href="#profile-messages">Notifications</a></span>
    </nav><!-- /profile_options -->

    <section id="profile-edit-account">
        <fieldset class="inputs">
            <legend><span>Account Status</span></legend>

            <div id="payment_blurb">
                Basic accounts allow you to participate in Spoonfeed. If you would like to be included in Soapbox, please upgrade to a Premium Account. A personal <%= link_to "premium account", "/account_types", :class => 'button' %> is $50/month. <%= link_to "More Information...", "/account_types", :class => 'button' %>
            </div>

            <div class="current">
                Your current account status is 
                <%= @user.public_account_type %> <%= @user.account_payer_type %>.
                <% if @user.premium_account? %>
                  <div id="start_date">
                      You have been a premium member since <%= @user.subscription.start_date.to_s(:long) %>
                  </div>
                  <% if @user.subscription && @user.subscription.in_overtime? %>
                    <div id="end_date">
                        This account has been canceled and will end
                        <%= @user.subscription.end_date.to_s(:long)%>
                    </div>
                  <% end %>
                <% end %>
            </div>

            <% if @user.staff_account? %>
            <div>
                Your account is managed by <%= h @user.subscription.payer.name %>.
            </div>
            <% else %>
              <%= render :partial => 'subscriptions/account_links', :locals => {:subscriber => @user, :subscriber_type => "user"} %>
            <% end %>
        </fieldset>
        
        <% semantic_form_for @user, :html => { :multipart => true } do |f| %>
            <fieldset class="headshot inputs">
                <legend><span>Profile Photo</span></legend>
                
                <div>
                    <%= image_tag @user.avatar.url(:thumb), :class => 'thumbnail' %>

                    <div class="clearfix headshot_fields">
                        <%= f.input :avatar, :as => "file", :label => "Upload a headshot" %>
                        <strong><%= f.errors_on :avatar_content_type %></strong>
                        <p class="clearfix">
                            <%= button_tag "Upload Headshot", :class => 'positive' %>
                            <span class="button-separator"></span> 
                            <%= link_to "Remove my headshot", remove_avatar_user_path(@user), :method => :put, :confirm => "Are you sure you want to remove your headshot? You'll have to upload another one later to get it back" %>
                        </p>
                    </div>
                </div>
            </fieldset>
        <% end %>
        
        <fieldset id="twitter-fieldset" class="inputs">
            <legend><span>Twitter</span></legend>
            
            <% if @user.twitter_authorized? -%>
            <p>You currently have your Twitter account set up as <em><%= @user.twitter_username %></em>. To change which Twitter account you want your SpoonFeed account linked with, you can remove the Twitter credentials below, and then setup Twitter again.<br/>
                <%= link_to "Remove Twitter Information", remove_twitter_user_path(@user), :confirm => "Are you sure you want to unlink your Twitter account? This action cannot be undone.", :class => 'remove_twitter', :method => :put %>
                <%= link_to 'Read Twitter Timeline', twitter_timelines_path, :class=>'read_twitter' %>
            </p>
            <% elsif @user.twitter_allowed? -%>
            <%= link_to "Setup Twitter", new_twitter_authorization_url, :class=>'sf-button' %>
            <% end -%>
            <p><%= link_to "Need Help?  Read our Twitter 101 introduction in the Marketing Manual.", public_page_path('twitter_101_introduction') %></p>
            
        </fieldset>

        <fieldset id="facebook-fieldset" class="inputs">
            <legend><span>Facebook</span></legend>
            <%- if @fb_user -%>
              <p>
                  You are currently linked to your Facebook account <em>"<%= @fb_user.name %>"</em>. You can connect to a different Facebook profile by disconnecting below, then setting up Facebook again.<br/>
                  <%= fb_logout_link "#{image_tag('x.png')} Disconnect", fb_deauth_user_path(@user), :class => 'button negative' %>
              </p>
              <% unless @fb_user.accounts.blank? %>
                <div class="clear" style="padding-top: 1em;">
                    <p>Configure a page to post status updates to:</p>
                    <% form_tag fb_page_auth_user_path(@user) do %>
                        <%= select_tag "facebook_page", "<option>&nbsp;</option>" + options_from_collection_for_select(@fb_user.accounts, :id, :name, @user.facebook_page_id.to_s) %>
                        <%= submit_tag "Save" %>
                    <% end %>
                </div>
              <% end %>

            <%- else -%>
              <%= link_to "Setup Facebook", fb_auth_user_path(@user), :class => 'sf-button' %>
            <%- end -%>
            <p><%= link_to "Need Help?  Read everything you need to know about Facebook in the Marketing Manual.", public_page_path('facebook_101_introduction') %></p>
        </fieldset>
        <div class="clear"></div>
        <hr class="edit_block" />
        
        <%= render :partial => 'users/form' %>
      

    </section><!-- /profile-account -->

    <section id="profile-summary">
        <% semantic_form_for @profile, :url => my_profile_path do |f| %>
            <% f.inputs :name => "Public Profile View", :for => :user do |user_form| %>
                <%= user_form.input :prefers_publish_profile, :as => :boolean, :label => 'Display my profile on Soapbox' %>
				<% button_tag :class => 'positive' do %>Save changes to public profile view<% end %>
            <% end %>

            <% f.inputs :name => 'Basic Information' do %>
                <%= f.input :birthday, :end_year => 1930, :start_year => Date.today.year, :selected => nil %>
                <%= f.input :job_start, :end_year => 1930, :start_year => Date.today.year, :selected => nil %>
                <%= f.input :headline %>
                <%= f.input :summary, :hint => "Keep it under 1000 characters" %>
                <%= f.input :hometown %>
                <%= f.input :current_residence, :label => "Currently residing in" %>
				<% button_tag :class => 'positive' do %>Save changes to basic information<% end %>

            <% end %>

            <% unless @profile.new_record? %>
            <% f.inputs :name => "Metro and Region for search" do %>
                <%= f.input :metropolitan_area %>
                <%= f.input :james_beard_region, :label => "Region" %>
<br />
				<% button_tag :class => 'positive' do %>Save changes for search<% end %>

            <% end %>

            <% f.inputs :name => "Current Employment" do %>
                <label>Select your primary job role:</label>
                <ul class="primary-employment">
                    <% for employment in @profile.user.employments %>
                    <li><%= radio_button_tag "profile[primary_employment][]", employment.id, primary?(employment) %> <%= employment.restaurant_role.try(:name) %> at <%= employment.restaurant.name %></li>
                    <% end %>
                </ul>
				<% button_tag :class => 'positive' do %>Save changes to employment<% end %>

            <% end %>

            <% f.inputs :name => "Contact Information" do %>
                <div class="clear">
                    <%= f.input :prefers_display_cell, :as => :radio, :collection => privacy_options, 
                        :label => "Show this to:", :wrapper_html => { :class => "show_this_to" } %>
                    <%= f.input :cellnumber, :label => "Cellphone", :wrapper_html => { :class => "span-6 last" } %>
                </div>

                <div class="clear">
                    <%= f.input :prefers_display_email, :as => :radio, :collection => privacy_options, 
                        :label => "Show this to:", :wrapper_html => { :class => "show_this_to" } %>
                    <% f.semantic_fields_for :user do |user| %>
                        <%= user.input :email, :wrapper_html => { :class => "span-6 last" } %>
                    <% end %>
                </div>

                <%- if @profile.user.twitter_authorized? -%>
                <div class="clear">
                    <%= f.input :prefers_display_twitter, :as => :radio, :collection => privacy_options, :label => "Show this to:", :wrapper_html => { :class => "show_this_to" } %>
                    <div class="span-6 last">Your Twitter account: <%= @profile.user.twitter_username %>
                        <p>(<%= link_to "Need to change your Twitter settings?", edit_my_profile_path(:anchor => "twitter") %>)</p>
                    </div>
                </div>
                <%- else -%>
                  <p><%= link_to "Set up Twitter", edit_my_profile_path(:anchor => "twitter") %></p>
                <%- end -%>

                <%- if @fb_user -%>
                <div class="clear">
                    <%= f.input :prefers_display_facebook, :as => :radio, :collection => privacy_options, :label => "Show this to:", :wrapper_html => { :class => "show_this_to" } %>
                    <div class="span-6 last">
                        Your Facebook account: <%= @fb_user.name %>
                        <p>(<%= link_to "Need to change your Facebook settings?", edit_my_profile_path(:anchor => "facebook") %>)</p>
                    </div>
                </div>
                <%- else -%>
                  <p><%= link_to "Set up Facebook", edit_my_profile_path(:anchor => "facebook") %></p>
                <%- end -%>

				<% button_tag :class => 'positive' do %>Save changes to contact information<% end %>

            <% end %><!-- Contact information -->

            <% f.inputs :name => "Cuisines and Specialties" do %>
                <%= f.input :specialties, :as => :check_boxes, :collection => Specialty.all, :label => "What are your specialties?" %>

                <div class="cuisines ajaxdelete">
                    <legend class="label"><label>Cuisines you are most known for:</label></legend>
                    <ul id="cuisines">
                        <%= render @profile.cuisines %>
                    </ul>
                    <% link_to new_my_profile_profile_cuisine_path, :class => 'positive button colorbox' do %>
                    <img src="/images/plus.png"/> Add
                    <% end %>
					

                </div>
<br />
					<% button_tag :class => 'positive' do %>Save changes to cuisines and specialties<% end %>
            <% end %><!-- Cuisines and specialties -->

            <% end %><%# non-basic details %>
        <% end %>
    </section><!-- /profile-summary -->

  <section id="profile-extended">
    <div id="extended_profile_fields">

      <%= render :partial => 'profiles/extended_profile_section', :locals => {
          :association => "culinary_jobs",
          :caption => "Work Experience - Restaurants",
          :form_path => new_my_profile_culinary_job_path} %>

      <%= render :partial => 'profiles/extended_profile_section', :locals => {
          :association => "nonculinary_jobs",
          :caption => "Work Experience - Nonculinary",
          :form_path => new_my_profile_nonculinary_job_path} %>

      <%= render :partial => 'profiles/extended_profile_section', :locals => {
          :association => "awards",
          :caption => "Awards",
          :form_path => new_my_profile_award_path} %>

      <%= render :partial => 'profiles/extended_profile_section', :locals => {
          :association => "accolades",
          :caption => "Accolades",
          :form_path => new_my_profile_accolade_path} %>

      <%= render :partial => 'profiles/extended_profile_section', :locals => {
          :association => "culinary_schools",
          :caption => "Education (Culinary)",
          :form_path => new_my_profile_enrollment_path} %>

      <% reset_cycle('default') -%>
      <div class="nonculinary_enrollments nonculinary_schools clear ajaxdelete">
          <h2>Education (Other)</h2>
          <ul id="nonculinary_enrollments">
              <%= render @profile.nonculinary_enrollments %>
          </ul>
          <%= link_to "add another", new_my_profile_nonculinary_enrollment_path, :class => 'add_extended colorbox'%>
      </div>

      <%= render :partial => 'profiles/extended_profile_section', :locals => {
          :association => "competitions",
          :caption => "Competitions",
          :form_path => new_my_profile_competition_path} %>

      <%= render :partial => 'profiles/extended_profile_section', :locals => {
          :association => "internships",
          :caption => "Internships",
          :form_path => new_my_profile_internship_path} %>

      <%= render :partial => 'profiles/extended_profile_section', :locals => {
          :association => "stages",
          :caption => "Stages",
          :form_path => new_my_profile_stage_path} %>

      <%= render :partial => 'profiles/extended_profile_section', :locals => {
          :association => "apprenticeships",
          :caption => "Apprenticeships",
          :form_path => new_my_profile_apprenticeship_path} %>
    
    </div><!-- #extended_profile_fields -->
  </section><!-- /profile-extended -->
  
  <section id="profile-messages">
    <% semantic_form_for @user do |f| %>

        <% f.inputs :name => 'Preferences' do %>
            <%= f.input :prefers_receive_email_notifications, :as => :boolean, :label => 'Receive email notifications?' %>
        <% end %>
        
        <p><%= button_tag "Save", :class => 'positive' %></p>

    <% end %>
  </section><!-- /profile-messages -->
</section><!-- /profile-tabs -->
<% title "#{@user.first_name}'s Profile", false %>

<div class="user_profile">
    <header id="profileHeader" class="clearfix">
        <div id="profileImage" class="left">
            <%= image_tag @user.avatar.url(:large) %>
        </div>
        <div id="profileDetails" class="right">
            <hgroup>
                <h2><%= @user.name %></h2>
                <% if @user.employments.any? %>
                  <h4>
                    <%= @user.primary_employment.try(:restaurant_role).try(:name) %>,
                    <%= restaurant_link(@user.primary_employment.restaurant) %>
                  </h4>
                  <% for employment in @user.nonprimary_employments %>
                  <h5>
                    <%= employment.try(:restaurant_role).try(:name) %>,
                    <span><%= restaurant_link(employment.restaurant) %></span>
                  </h5>
                  <% end %>
                <% elsif @user.default_employment %>
                  <h4>
                    <%= @user.primary_employment.try(:restaurant_role).try(:name) %>,
                    <%= @user.primary_employment.try(:solo_restaurant_name) %>
                  </h4>
                <% end %>

                <h5>Resides in <span><%= @user.profile.try(:current_residence) %></span></h5>
            </hgroup>
            <div id="meta">
                <% if @user.profile.present? -%>
                <h4>Specialties</h4>
                <ul id="tags">
                    <% for specialty in @user.profile.specialties -%>
                    <li><%= link_to specialty.name, directory_search_link(:specialty_id => specialty.id) %></li>
                    <% end -%>
                </ul>
                <% end -%>
            </div>
        </div>
    </header>

    <aside id="sidebar" class="left">
        <div id="facts">
            <div class="contactDetails">
                <h3>Quick Facts</h3>
                <% if display_twitter(@user) -%>
                <h4>twitter: <span><%= link_to @user.twitter_username, "http://twitter.com/#{@user.twitter_username}" %></span></h4>
                <% end -%>

                <% if display_facebook(@user) -%>
                <h4>facebook: <span><%= link_to @user.facebook_user.name, @user.facebook_user.link %></span></h4>
                <% end -%>

                <h4>blog: <span><%= link_to_unimplemented "firstname.com" %></span></h4>

                <% if display_cell(@user) -%>
                <h4>contact: <span><%= @user.profile.cellnumber %></span></h4>
                <% end -%>
            </div>

            <% if @user.profile.try(:cuisines).present? -%>
            <h5>cuisines known for:</h5>
            <p>
                <%= @user.profile.cuisines.map { |c| link_to c.name, directory_search_link(:cuisine_id => c.id) }.join(", ") %>
            </p>
            <% end -%>

            <% if @user.profile.try(:job_start).present? -%>
            <h5>job start:</h5>
            <p><%= @user.profile.job_start.try(:strftime, '%B %d, %Y') %></p>
            <% end -%>

            <% if @user.profile.try(:birthday).present? -%>
            <h5>age:</h5>
            <p><%= age(@user.profile.birthday) %></p>
            <% end -%>

            <% if @user.profile.try(:hometown).present? -%>
            <h5>birthplace:</h5>
            <p><%= @user.profile.hometown %></p>
            <% end -%>

            <% if @user.profile.try(:current_residence).present? -%>
            <h5>resides:</h5>
            <p><%= @user.profile.try(:current_residence) %></p>
            <% end -%>
        </div>
        <div id="background">
            <h3 class="green">Background</h3>
            <p><%= @user.profile.try(:summary) %></p>
        </div>
    </aside>

    <section id="profileContent" class="clearfix right">

        <% if @user.btl_enabled? && (@user.published_topics.present? || @user == current_user || current_user.try(:admin?)) %>
          <%= render :partial => 'profiles/behind_the_line', :locals => { :user => @user } %>
        <% end %>

        <div id="question" class="right profileBox">
            <h3>Question of the day<span class="greenArrow"></span></h3>

            <% if @user.qotd_convos_with_comments.present? -%>
              <% for conversation in @user.qotd_convos_with_comments -%>
              <h4><%= conversation.admin_message.message %></h4>
              <p>
                  <%= conversation.comments.first.comment %>
              </p>
              <% end -%>
            <% else -%>
              <p><%= @user.name %> hasn't answered any Questions of the Day yet.</p>
            <% end -%>
            <%= link_to_unimplemented "learn more about #{@user.first_name}", :class => "greenLink" %>
        </div>

        <% if @user.qotd_convos_with_comments.present? -%>
        <div class="clear quoteBox">
            <div class="quote">
                <h4><%= @user.qotd_convos_with_comments.first.admin_message.message %></h4>
                <p><%= @user.qotd_convos_with_comments.first.comments.first.comment %></p>
            </div>
        </div>
        <% end -%>

        <div id="guides" class="clear clearfix">

            <h3><%= @user.first_name %>'s Guides<span class="grayArrow"></span></h3>

            <div id="entertaining" class="left">
                <div>
                    <h4>Entertainment</h4>
                    <p class="description">Get Firstname’s tips and hints for home cooks bartenders and sommeliers:</p>
                    <p class="ask"><span>Mauris bibendum erat nec?</span>Phasellus vitae ante arcu. Donec tempus justo eget augue pellentesque.</p>
                    <p class="ask"><span>Mauris bibendum erat nec?</span>Phasellus vitae ante arcu. Donec tempus justo eget augue pellentesque.</p>
                    <%= link_to_unimplemented "read more tips + hints", :class => "orangeLink" %>
                </div>
            </div>

            <div id="travel" class="right">
                <div>
                    <h4>Travel</h4>
                    <p class="description">Find out <%= @user.first_name %>’s favorite haunts around the world:</p>
                    <ul>
                        <% for city in Topic.travel.chapters.for_user(@user) %>
                        <li><%= link_to city.title, link_for_user_questions(:user_id => @user.id, :chapter_id => city.id) %></li>
                        <% end if Topic.travel.present? %>
                    </ul>
                </div>
            </div>

        </div>

    </section>
</div>

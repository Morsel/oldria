<% javascript 'ckeditor/ckeditor' %>
<% title "Newsletter :: #{@restaurant.name}", false %>

<div id="restaurant_profile_view" class="edit clear clearfix">
    <%= render 'restaurants/restaurant_editing_header' %>

    <div id="editing_restaurant">
        <div id="restaurant_pages" class="clearfix">

            <%- if @restaurant.premium_account? -%>

              <nav id="restaurant_feature_nav">
                <%= active_link_to 'Settings', restaurant_newsletters_path(:restaurant_id => @restaurant) %>
                <%= active_link_to 'Subscribers', newsletter_subscriptions_restaurant_path(@restaurant) if @restaurant.shareable_newsletter_subscribers.present? %>
                <%= active_link_to 'Archives', archives_restaurant_newsletters_path(:restaurant_id => @restaurant) %>
                
              </nav>

              <div id="restaurant_features_content" style="width:700px;">

                <h1 class="pg_title">Newsletter Settings</h1>
                <P><strong>Newsletters must be approved before they are sent to your mailing list. </strong> To approve your newsletter, please click preview newsletter to view and then click approve newsletter below. </P>
                <p> </p>

                <div id="newsletter_settings" class="clearfix">
                  <% semantic_form_for @restaurant, :url => update_settings_restaurant_newsletters_path do |f| %>
                    <% f.inputs :class => "editing" do %>
                      <%= f.input :newsletter_frequency, :as => :select, :collection => ["weekly", "biweekly", "monthly"], :input_html => { :style => 'width:150px;' }  %>
                      <%= submit_tag "Save" %>
                    <% end %>
                    <% f.inputs :class => "editing" do %>
                      <%= f.input :tag_line, :as => :text,:label=>"Newsletter Tagline", :input_html => { :style => 'margin-bottom: 12px;' }  %>

                      <%= submit_tag "Add newsletter headline" %>
                    <% end %>
                  <% end %>

                  <% semantic_form_for @restaurant, :url => update_settings_restaurant_newsletters_path do |f| %>
                     
                        <% f.semantic_fields_for :newsletter_setting do |ns| %>
                            <% f.inputs do %>
                                <li class="span-12">
                                    <label for="page_content_editor">Introduction</label>
                                  <%= ns.cktext_area :introduction, :height => '340px'%>
                                </li>
                            <% end %>
                        <% end %>
                        <%= submit_tag "Add newsletter introduction" %>
            
                  <% end %>

                </div>

                <div id="restaurant_actions" class="clearfix"><p>To preview your newsletter, click the preview newsletter button. <br>
                  <%= button_to "Preview newsletter", preview_restaurant_newsletters_path(@restaurant), :popup => true, :class => 'button',:method=>"get" %></p>
                  <% unless @restaurant.newsletter_approved? %><p>Approve your newsletter to send at regularly scheduled interval.<br>
                    <%= button_to "Approve newsletter", approve_restaurant_newsletters_path(@restaurant), :method => 'post', :confirm => 'Are you sure you want to approve this newsletter for delivery?' %></p>
                  <% end %><p>To send your newsletter to your list right now, select Send Newsletter<br>
                  <%= button_to "Send newsletter", restaurant_newsletters_path(@restaurant), :confirm => 'Are you sure you want to send this newsletter right now?'%>
               </p> </div>

              </div>

            <%- else -%>
              <p><%= link_to "Upgrade to a premium account", new_subscription_path(@restaurant) %> to access your newsletter!</p>
            <%- end -%>

        </div>
    </div><!-- /editing_restaurant -->
</div><!-- /restaurant_profile_view -->

<% content_for :javascript do %>
<script type="text/javascript">
  $(document).ready(function(){  
    $('input[type=submit][popup=true]').parents('form').attr("target","_blank")
  })
  </script>
<% end %>